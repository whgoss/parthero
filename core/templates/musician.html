{% extends "base.html" %}
{% load roster %}
{% block content %}
  <div class="max-w-5xl mx-auto">
    <!-- Messages -->
    {% include "partials/messages.html" with messages=messages %}

    <!-- Top nav / breadcrumb -->
    <div class="flex items-center justify-between gap-4 mb-2">
      <a href="{% url 'roster' %}"
         class="inline-flex items-center text-sm font-medium text-slate-500 hover:text-slate-900">
        <svg xmlns="http://www.w3.org/2000/svg"
             viewBox="0 0 20 20"
             fill="none"
             stroke="currentColor"
             class="mr-1 h-4 w-4">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6"
                d="M12.5 4.5 7 10l5.5 5.5" />
        </svg>
        Back to Roster
      </a>
    </div>

    <!-- Header -->
    <div class="mb-6 flex items-center justify-between gap-4">
      <div class="flex items-center gap-4">
        {% if musician %}
          <div class="flex h-12 w-12 items-center justify-center rounded-full bg-blue-100 text-sm font-semibold text-blue-700">
            {{ musician.first_name|first }}{{ musician.last_name|first }}
          </div>
        {% endif %}
        <div>
          {% if musician %}
            <h1 class="page-header">
              Edit Musician
            </h1>
            <p class="page-subheader">
              Update contact info and section assignments.
            </p>
          {% else %}
            <h1 class="page-header">
              Create Musician
            </h1>
            <p class="page-subheader">
              Create contact info and section assignments.
            </p>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Main form card -->
    <form id="musician-edit-form"
          method="post"
          class="space-y-6 rounded-2xl border border-slate-200 px-6 py-2 bg-white shadow-sm">
      {% csrf_token %}

      <!-- Basic info -->
      <div class="grid grid-cols-1 gap-6 md:grid-cols-2 mt-3 p-2">
        <div>
          <label class="form-label">
            First Name
          </label>
          {{ form.first_name }}
          {% if form.first_name.errors %}<p class="text-red-600 text-xs mt-1 font-bold">{{ form.first_name.errors|striptags }}</p>{% endif %}
        </div>

        <div>
          <label class="form-label">
            Last Name
          </label>
          {{ form.last_name }}
          {% if form.last_name.errors %}<p class="text-red-600 text-xs mt-1 font-bold">{{ form.last_name.errors|striptags }}</p>{% endif %}
        </div>

        <div class="md:col-span-2">
          <label for="{{ form.email.id_for_label }}" class="form-label">
            Email
          </label>
          {{ form.email }}
          {% if form.email.errors %}<p class="text-red-600 text-xs mt-1 font-bold">{{ form.email.errors|striptags }}</p>{% endif %}
        </div>
      </div>

      <!-- Principal toggle -->
      <div class="flex items-start justify-between gap-4 rounded-2xl p-2">
        <div>
          <p class="form-label">
            Principal
          </p>
          <p class="text-xs text-slate-500">
            Principals decide who receives what parts for a program.
          </p>
        </div>

        <label class="inline-flex cursor-pointer items-center gap-3 select-none">
            <span class="text-sm font-light">No</span>
            <input
                type="checkbox"
                name="principal"
                class="sr-only toggle-input"
                {% if musician.principal %}value="true"{% endif %}
                {% if musician.principal %}checked="checked"{% endif %}
            />

            <span class="track relative inline-flex h-6 w-11 items-center rounded-full bg-gray-200 transition-colors">
                <span
                class="thumb h-5 w-5 rounded-full bg-white shadow transform transition-transform translate-x-0"
                ></span>
            </span>
            <span class="text-sm font-light">Yes</span>
        </label>
      </div>

      <!-- Core member toggle -->
      <div class="flex items-start justify-between gap-4 rounded-2xl p-2">
        <div>
          <p class="form-label">
            Core Member
          </p>
          <p class="text-xs text-slate-500">
            Core members are a subset of the master roster that are frequently featured in programs.
          </p>
        </div>

        <label class="inline-flex cursor-pointer items-center gap-3 select-none">
            <span class="text-sm font-light">No</span>
            <input
                type="checkbox"
                name="core_member"
                class="sr-only toggle-input"
                {% if musician.core_member %}value="true"{% endif %}
                {% if musician.core_member %}checked="checked"{% endif %}
            />

            <span class="track relative inline-flex h-6 w-11 items-center rounded-full bg-gray-200 transition-colors">
                <span
                class="thumb h-5 w-5 rounded-full bg-white shadow transform transition-transform translate-x-0"
                ></span>
            </span>
            <span class="text-sm font-light">Yes</span>
        </label>
      </div>

      <!-- Instruments Section -->
      <!-- Primary Instrument-->
      {{ primary_instrument|json_script:"primary_instrument" }}
      {{ instrument_options|json_script:"instrument-options" }}
      {{ secondary_instruments|json_script:"secondary_instruments" }}
      <div class="grid grid-cols-5 items-start justify-between gap-4 rounded-2xl p-2">
        <div class="col-span-2">
          <label for="primary_instrument"
            class="form-label">
            Primary Instrument
          </label>
          <p class="text-xs text-slate-500">
            Type to assign a primary instrument/section. This is the default instrument selected when adding a musician to a program.
          </p>
        </div>
        
        <input
          id="primary_instrument"
          name="primary_instrument"
          type="text"
          required
          data-options-id="instrument-options"
          data-initial-id="primary_instrument"
          class="col-span-3 instrument block w-full rounded-xl border border-slate-200 px-3 py-2 text-sm shadow-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-100"
        />
        <div class="col-span-3 col-start-3">
          {% if form.primary_instrument.errors %}
            <p class="text-red-600 text-xs mt-1 font-bold">{{ form.primary_instrument.errors|striptags }}</p>
          {% endif %}
        </div>
        <div class="col-span-2">
          <label for="secondary_instruments"
            class="form-label">
            Secondary Instruments
          </label>
          <p class="text-xs text-slate-500">
            Type to assign one or more secondary instruments/sections.
          </p>
        </div>
        <input
          id="secondary_instruments"
          name="secondary_instruments"
          type="text"
          data-options-id="instrument-options"
          data-initial-id="secondary_instruments"
          class="col-span-3 instruments block w-full rounded-xl border border-slate-200 px-3 py-2 text-sm shadow-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-100"
        />
      </div>

      <!-- Primary actions -->
      <div class="flex justify-end gap-3 mb-4">
        <a href="{% url 'roster' %}"
           class="btn-secondary">
          Cancel
        </a>
        <button type="submit" form="musician-edit-form"
                class="btn-primary">
          <svg xmlns="http://www.w3.org/2000/svg"
               viewBox="0 0 20 20"
               fill="none"
               stroke="currentColor"
               class="h-4 w-4">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.7"
                  d="M5 10.5 8.5 14 15 6" />
          </svg>
          Save Changes
        </button>
      </div>
    </form>
  </div>
{% endblock %}
