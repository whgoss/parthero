{% extends "base.html" %}
{% load roster %}
{% block content %}
  <div class="max-w-5xl mx-auto">
    <!-- Messages -->
    {% include "partials/messages.html" with messages=messages %}

    <!-- Top nav / breadcrumb -->
    <div class="flex items-center justify-between gap-4 mb-2">
      <a href="{% url 'roster' %}"
         class="inline-flex items-center text-sm font-medium text-slate-500 hover:text-slate-900">
        <svg xmlns="http://www.w3.org/2000/svg"
             viewBox="0 0 20 20"
             fill="none"
             stroke="currentColor"
             class="mr-1 h-4 w-4">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6"
                d="M12.5 4.5 7 10l5.5 5.5" />
        </svg>
        Back to roster
      </a>
    </div>

    <!-- Header -->
    <div class="mb-6 flex items-center justify-between gap-4">
      <div class="flex items-center gap-4">
        {% if musician %}
        <div class="flex h-12 w-12 items-center justify-center rounded-full bg-blue-100 text-sm font-semibold text-blue-700">
          {{ musician.first_name|first }}{{ musician.last_name|first }}
        </div>
        {% endif %}
        <div>
          {% if musician %}
          <h1 class="text-xl font-semibold text-slate-900">
            Edit Musician
          </h1>
          <p class="text-sm text-slate-500">
            Update contact info and section assignments.
          </p>
          {% else %}
          <h1 class="text-xl font-semibold text-slate-900">
            Create Musician
          </h1>
          <p class="text-sm text-slate-500">
            Create contact info and section assignments.
          </p>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Main form card -->
    <form id="musician-edit-form"
          method="post"
          class="space-y-6 rounded-2xl border border-slate-200 px-6 py-2 bg-white shadow-sm">
      {% csrf_token %}

      <!-- Basic info -->
      <div class="grid grid-cols-1 gap-6 md:grid-cols-2">
        <div>
          <label class="mb-1 block text-sm font-medium text-slate-700">
            First Name
          </label>
          {{ form.first_name }}
          {% if form.first_name.errors %}<p class="text-red-600 text-xs mt-1 font-bold">{{ form.first_name.errors|striptags }}</p>{% endif %}
        </div>

        <div>
          <label class="mb-1 block text-sm font-medium text-slate-700">
            Last Name
          </label>
          {{ form.last_name }}
          {% if form.last_name.errors %}<p class="text-red-600 text-xs mt-1 font-bold">{{ form.last_name.errors|striptags }}</p>{% endif %}
        </div>

        <div class="md:col-span-2">
          <label for="{{ form.email.id_for_label }}" class="mb-1 block text-sm font-medium">
            Email
          </label>
          {{ form.email }}
          {% if form.email.errors %}<p class="text-red-600 text-xs mt-1 font-bold">{{ form.email.errors|striptags }}</p>{% endif %}
        </div>
      </div>

      <!-- Principal toggle -->
      <div class="flex items-start justify-between gap-4 rounded-2xl bg-slate-50 py-3">
        <div>
          <p class="text-sm font-medium text-slate-800">
            Principal
          </p>
          <p class="text-xs text-slate-500">
            Principals decide who receives what parts for a program.
          </p>
        </div>

        <label class="inline-flex cursor-pointer items-center gap-3 select-none">
            <span class="text-sm font-light">No</span>
            <input
                type="checkbox"
                name="principal"
                class="sr-only toggle-input"
                {% if musician.principal %}value="true"{% endif %}
                {% if musician.principal %}checked="checked"{% endif %}
            />

            <span class="track relative inline-flex h-6 w-11 items-center rounded-full bg-gray-200 transition-colors">
                <span
                class="thumb h-5 w-5 rounded-full bg-white shadow transform transition-transform translate-x-0"
                ></span>
            </span>
            <span class="text-sm font-light">Yes</span>
        </label>
      </div>

      <!-- Core member toggle -->
      <div class="flex items-start justify-between gap-4 rounded-2xl bg-slate-50 py-3">
        <div>
          <p class="text-sm font-medium text-slate-800">
            Core member
          </p>
          <p class="text-xs text-slate-500">
            Core members are a subset of the master roster that are frequently featured in programs.
          </p>
        </div>

        <label class="inline-flex cursor-pointer items-center gap-3 select-none">
            <span class="text-sm font-light">No</span>
            <input
                type="checkbox"
                name="core_member"
                class="sr-only toggle-input"
                {% if musician.core_member %}value="true"{% endif %}
                {% if musician.core_member %}checked="checked"{% endif %}
            />

            <span class="track relative inline-flex h-6 w-11 items-center rounded-full bg-gray-200 transition-colors">
                <span
                class="thumb h-5 w-5 rounded-full bg-white shadow transform transition-transform translate-x-0"
                ></span>
            </span>
            <span class="text-sm font-light">Yes</span>
        </label>
      </div>

      <!-- Section pills -->
      <div class="bg-slate-50/60">
        <label for="instruments" class="mb-1 block text-sm font-medium">
          Instruments
        </label>
        <p class="text-xs text-slate-500">
          Assign one or more sections. Hover a pill to remove it; use the + pill to add more.
        </p>

        <input
          id="instruments"
          name="instruments"
          type="text"
          data-options='{{ instrument_options|safe }}'
          data-initial='{{ instruments|safe }}'
          class="instruments block w-full rounded-xl border border-slate-200 px-3 py-2 text-sm shadow-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-100"
        />
      </div>

      <!-- Primary actions -->
      <div class="flex justify-end gap-3">
        <a href="{% url 'roster' %}"
           class="rounded-full border border-gray-200 px-4 py-2 text-sm font-medium text-gray-600 hover:border-gray-300 hover:bg-gray-50">
          Cancel
        </a>
        <button type="submit" form="musician-edit-form"
                class="inline-flex items-center gap-2 rounded-full bg-blue-600 px-5 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700">
          <svg xmlns="http://www.w3.org/2000/svg"
               viewBox="0 0 20 20"
               fill="none"
               stroke="currentColor"
               class="h-4 w-4">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.7"
                  d="M5 10.5 8.5 14 15 6" />
          </svg>
          Save changes
        </button>
      </div>
    </form>
  </div>
{% endblock %}
